# äººç”Ÿ K çº¿é¡¹ç›® - å®Œæ•´æŠ€æœ¯æ ˆä¸äº§å“æ–‡æ¡£

> **é¡¹ç›®åœ°å€**ï¼šhttps://lesliewylie.github.io  
> **GitHub**ï¼šhttps://github.com/LeslieWylie/LeslieWylie.github.io  
> **æŠ€æœ¯æ ˆ**ï¼šReact 19 + TypeScript + Vite + Tailwind CSS + Recharts + Supabase

---

## ğŸ“‘ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#ä¸€é¡¹ç›®æ¦‚è¿°)
2. [äº§å“éœ€æ±‚æ–‡æ¡£ï¼ˆPRDï¼‰](#äºŒäº§å“éœ€æ±‚æ–‡æ¡£prd)
3. [æœ€å°MVPå®šä¹‰](#ä¸‰æœ€å°mvpå®šä¹‰)
4. [æŠ€æœ¯æ ˆæ·±åº¦è§£æ](#å››æŠ€æœ¯æ ˆæ·±åº¦è§£æ)
5. [æ ¸å¿ƒåŠŸèƒ½å®ç°ç»†èŠ‚](#äº”æ ¸å¿ƒåŠŸèƒ½å®ç°ç»†èŠ‚)
6. [æ¶æ„è®¾è®¡](#å…­æ¶æ„è®¾è®¡)
7. [æ•°æ®æµä¸çŠ¶æ€ç®¡ç†](#ä¸ƒæ•°æ®æµä¸çŠ¶æ€ç®¡ç†)
8. [æ€§èƒ½ä¼˜åŒ–å®è·µ](#å…«æ€§èƒ½ä¼˜åŒ–å®è·µ)
9. [é¢è¯•å›ç­”è¦ç‚¹](#ä¹é¢è¯•å›ç­”è¦ç‚¹)

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®å®šä½

**äººç”Ÿ K çº¿**æ˜¯ä¸€ä¸ªåˆ›æ–°çš„å‘½ç†å¯è§†åŒ–å·¥å…·ï¼Œå°†ä¼ ç»Ÿå…«å­—å‘½ç†å­¦ä¸ç°ä»£é‡‘è K çº¿å›¾æŠ€æœ¯ç›¸ç»“åˆã€‚é€šè¿‡ AI å¤§æ¨¡å‹åˆ†æç”¨æˆ·çš„ç”Ÿè¾°å…«å­—ï¼Œç”Ÿæˆ 100 å¹´çš„äººç”Ÿè¿åŠ¿ K çº¿å›¾ï¼Œå¸®åŠ©ç”¨æˆ·ä»¥ç›´è§‚çš„æ–¹å¼äº†è§£äººç”Ÿèµ·ä¼ã€æŠŠæ¡å…³é”®è½¬æŠ˜ç‚¹ã€‚

### 1.2 æ ¸å¿ƒä»·å€¼ä¸»å¼ 

- **é™ä½ä½¿ç”¨é—¨æ§›**ï¼šå°†å¤æ‚çš„æ’ç›˜æµç¨‹ç®€åŒ–ä¸º 3 æ­¥æ“ä½œ
- **å¯è§†åŒ–è¶‹åŠ¿**ï¼šç”¨ K çº¿å›¾å±•ç¤ºäººç”Ÿè¿åŠ¿ï¼Œç›´è§‚æ˜“æ‡‚
- **å¤šç»´åº¦åˆ†æ**ï¼šä»æ€»è¯„ã€äº‹ä¸šã€è´¢å¯Œã€æ„Ÿæƒ…ã€å¥åº·ã€å…­äº²ç­‰ç»´åº¦å…¨é¢åˆ†æ
- **æ•°æ®é©±åŠ¨è¿­ä»£**ï¼šé€šè¿‡åŸ‹ç‚¹å’Œåé¦ˆæŒç»­ä¼˜åŒ–äº§å“

### 1.3 ç›®æ ‡ç”¨æˆ·

- **ä¸»è¦ç”¨æˆ·**ï¼šå¯¹å‘½ç†æ„Ÿå…´è¶£çš„æŠ€æœ¯ä»ä¸šè€…ã€å‘½ç†çˆ±å¥½è€…
- **æ¬¡è¦ç”¨æˆ·**ï¼šå¸Œæœ›äº†è§£äººç”Ÿè§„åˆ’çš„ç”¨æˆ·
- **ä½¿ç”¨åœºæ™¯**ï¼šä¸ªäººå‘½ç†åˆ†æã€äººç”Ÿè§„åˆ’å‚è€ƒã€æ–‡åŒ–ç ”ç©¶

---

## äºŒã€äº§å“éœ€æ±‚æ–‡æ¡£ï¼ˆPRDï¼‰

### 2.1 äº§å“èƒŒæ™¯

#### 2.1.1 å¸‚åœºç—›ç‚¹

ä¼ ç»Ÿå‘½ç†å·¥å…·å­˜åœ¨ä¸‰å¤§ç—›ç‚¹ï¼š

1. **è¾“å…¥ç¹ç**ï¼šæ’ç›˜æ­¥éª¤å¤æ‚ï¼Œéœ€è¦ç†è§£å¹²æ”¯ã€å¤§è¿ç­‰æ¦‚å¿µ
2. **ç»“æœæŠ½è±¡**ï¼šè¾“å‡ºä»¥é•¿æ–‡ä¸ºä¸»ï¼Œç¼ºå°‘è¶‹åŠ¿è§†è§’ï¼Œéš¾ä»¥æ¯”è¾ƒä¸åŒé˜¶æ®µ
3. **ç»“æœéš¾ä¿å­˜/å¤ç›˜**ï¼šç¼ºå°‘ç»“æ„åŒ–å­˜å‚¨å’Œå†å²å¯¹æ¯”åŠŸèƒ½

#### 2.1.2 è§£å†³æ–¹æ¡ˆ

- **ç®€åŒ–æµç¨‹**ï¼š3 æ­¥ä¸»è·¯å¾„ï¼ˆå¡«å…«å­— â†’ ç”Ÿæˆ Prompt â†’ ä¸Šä¼  JSONï¼‰
- **å¯è§†åŒ–å±•ç¤º**ï¼šK çº¿å›¾å±•ç¤º 100 å¹´è¿åŠ¿èµ°åŠ¿
- **å¤šç»´åº¦æ‹†åˆ†**ï¼š6 å¤§ç»´åº¦è¯„åˆ†ä½“ç³»
- **æ•°æ®æŒä¹…åŒ–**ï¼šæ”¯æŒ JSON/PNG/PDF å¯¼å‡ºï¼Œæœ¬åœ°å­˜å‚¨å†å²è®°å½•

### 2.2 åŠŸèƒ½éœ€æ±‚

#### 2.2.1 æ ¸å¿ƒåŠŸèƒ½ï¼ˆP0 - å¿…é¡»å®ç°ï¼‰

**F1ï¼šå…«å­—è¾“å…¥è¡¨å•**
- è¾“å…¥å­—æ®µï¼šå§“åï¼ˆå¯é€‰ï¼‰ã€æ€§åˆ«ã€å‡ºç”Ÿå¹´ä»½ã€å››æŸ±å¹²æ”¯ã€èµ·è¿å¹´é¾„ã€ç¬¬ä¸€æ­¥å¤§è¿
- è‡ªåŠ¨è®¡ç®—ï¼šå¤§è¿æ’åºæ–¹å‘ï¼ˆé¡ºè¡Œ/é€†è¡Œï¼‰
- éªŒè¯è§„åˆ™ï¼šå¹²æ”¯æ ¼å¼éªŒè¯ã€å¹´ä»½èŒƒå›´éªŒè¯ï¼ˆ1900-2100ï¼‰

**F2ï¼šPrompt ç”Ÿæˆ**
- æ”¯æŒå¤šç§ Prompt ç±»å‹ï¼šdefaultã€detailedã€detailed_v2ã€detailed_v3ã€detailed_v4
- ç”ŸæˆåŒæ®µå¼ Promptï¼šç³»ç»Ÿè§’è‰²è®¾å®š + ç”¨æˆ·æç¤ºè¯
- ä¸€é”®å¤åˆ¶åŠŸèƒ½ï¼šåˆ†åˆ«å¤åˆ¶ç³»ç»Ÿæç¤ºã€ç”¨æˆ·æç¤ºã€å®Œæ•´å¯¹è¯

**F3ï¼šæ–‡ä»¶ä¸Šä¼ ä¸æ•°æ®è§£æ**
- æ”¯æŒæ‹–æ‹½ä¸Šä¼  JSON æ–‡ä»¶
- æ”¯æŒç²˜è´´ JSON æ–‡æœ¬
- è‡ªåŠ¨è¯†åˆ«æ•°æ®æ ¼å¼ç‰ˆæœ¬ï¼ˆV1/V2/V3/V4ï¼‰
- æ•°æ®æ ¼å¼è½¬æ¢å’ŒéªŒè¯

**F4ï¼šK çº¿å›¾å¯è§†åŒ–**
- 100 å¹´è¿åŠ¿ K çº¿å›¾å±•ç¤º
- æ”¯æŒç¼©æ”¾ã€ç­›é€‰ã€å…³é”®å¹´ä»½æ ‡æ³¨
- ç‚¹å‡» K çº¿æŸ¥çœ‹è¯¦ç»†æµå¹´æ‰¹æ–­
- å¤§è¿åˆ†ç•Œçº¿è‡ªåŠ¨æ ‡æ³¨

**F5ï¼šå¤šç»´åº¦åˆ†æ**
- 6 ä¸ªç»´åº¦è¯„åˆ†å±•ç¤ºï¼ˆæ€»è¯„ã€äº‹ä¸šã€è´¢å¯Œã€å©šå§»ã€å¥åº·ã€å…­äº²ï¼‰
- å¤šç»´åº¦ K çº¿å›¾ï¼ˆå„ç»´åº¦è¶‹åŠ¿æ›²çº¿ï¼‰
- ç»Ÿè®¡åˆ†æé¢æ¿ï¼ˆå¹³å‡å€¼ã€æœ€é«˜/æœ€ä½å¹´ä»½ï¼‰

#### 2.2.2 é‡è¦åŠŸèƒ½ï¼ˆP1 - åº”è¯¥å®ç°ï¼‰

**F6ï¼šå†å²è®°å½•**
- æœ¬åœ°å­˜å‚¨å†å²è®°å½•ï¼ˆlocalStorageï¼‰
- å†å²è®°å½•é¢æ¿å±•ç¤º
- ä¸€é”®åŠ è½½å†å²è®°å½•

**F7ï¼šæ•°æ®å¯¼å‡º**
- å¯¼å‡º JSON æ ¼å¼
- å¯¼å‡º PNG å›¾ç‰‡
- å¯¼å‡º PDF æŠ¥å‘Š

**F8ï¼šä½¿ç”¨æ—¥å¿—ï¼ˆå¯é€‰ï¼‰**
- å‰ç«¯åŸ‹ç‚¹ä¸ŠæŠ¥
- åç«¯å­˜å‚¨åˆ° Supabase
- è®°å½•æ ¸å¿ƒæ“ä½œï¼šç”Ÿæˆ Promptã€ä¸Šä¼ ç»“æœã€æŸ¥çœ‹å†å²ç­‰

#### 2.2.3 å¢å¼ºåŠŸèƒ½ï¼ˆP2 - å¯ä»¥å»¶åï¼‰

**F9ï¼šå¤šç»´åº¦ K çº¿å›¾**
- å„ç»´åº¦è¶‹åŠ¿æ›²çº¿å¯¹æ¯”
- ç»´åº¦å¼€å…³æ§åˆ¶
- å¹³å‡åˆ†å‚è€ƒçº¿

**F10ï¼šç‰ˆæœ¬æ›´æ–°å…¬å‘Š**
- é¦–æ¬¡è®¿é—®å¼¹çª—
- localStorage è®°å½•å·²è¯»çŠ¶æ€
- å¼•å¯¼ç”¨æˆ·å¡«å†™é—®å·

### 2.3 éåŠŸèƒ½éœ€æ±‚

#### 2.3.1 æ€§èƒ½è¦æ±‚
- é¦–å±åŠ è½½æ—¶é—´ < 2s
- å›¾è¡¨æ¸²æŸ“æµç•…ï¼ˆ60fpsï¼‰
- æ”¯æŒ 100 ä¸ªæ•°æ®ç‚¹æµç•…äº¤äº’

#### 2.3.2 å…¼å®¹æ€§è¦æ±‚
- æ”¯æŒç°ä»£æµè§ˆå™¨ï¼ˆChromeã€Firefoxã€Edgeã€Safariï¼‰
- å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯è®¿é—®
- æ”¯æŒè§¦æ‘¸æ“ä½œï¼ˆç¼©æ”¾ã€æ»‘åŠ¨ï¼‰

#### 2.3.3 å¯ç”¨æ€§è¦æ±‚
- 3 æ­¥ä¸»æµç¨‹ï¼Œé™ä½å­¦ä¹ æˆæœ¬
- å‹å¥½çš„é”™è¯¯æç¤º
- è¯¦ç»†çš„ä½¿ç”¨å¸®åŠ©æ–‡æ¡£

---

## ä¸‰ã€æœ€å°MVPå®šä¹‰

### 3.1 MVP ç›®æ ‡

**æ ¸å¿ƒç›®æ ‡**ï¼šéªŒè¯"å°†å‘½ç†ç»“æœå¯è§†åŒ–"çš„æ ¸å¿ƒä»·å€¼ï¼Œå¿«é€Ÿä¸Šçº¿è·å–ç”¨æˆ·åé¦ˆã€‚

### 3.2 MVP åŠŸèƒ½èŒƒå›´

#### 3.2.1 å¿…é¡»åŒ…å«çš„åŠŸèƒ½ï¼ˆMVP Coreï¼‰

1. **å…«å­—è¾“å…¥è¡¨å•**
   - åŸºç¡€å­—æ®µï¼šæ€§åˆ«ã€å‡ºç”Ÿå¹´ä»½ã€å››æŸ±å¹²æ”¯ã€èµ·è¿å¹´é¾„ã€ç¬¬ä¸€æ­¥å¤§è¿
   - è‡ªåŠ¨è®¡ç®—å¤§è¿æ–¹å‘
   - åŸºç¡€éªŒè¯

2. **Prompt ç”Ÿæˆï¼ˆç®€åŒ–ç‰ˆï¼‰**
   - å•ä¸€ Prompt ç±»å‹ï¼ˆdefaultï¼‰
   - ç”Ÿæˆç³»ç»Ÿæç¤º + ç”¨æˆ·æç¤º
   - ä¸€é”®å¤åˆ¶åŠŸèƒ½

3. **æ–‡ä»¶ä¸Šä¼ **
   - æ‹–æ‹½ä¸Šä¼  JSON æ–‡ä»¶
   - åŸºç¡€æ•°æ®éªŒè¯
   - æ”¯æŒ V1 æ ¼å¼ï¼ˆæœ€ç®€æ ¼å¼ï¼‰

4. **K çº¿å›¾å±•ç¤º**
   - åŸºç¡€ K çº¿å›¾ï¼ˆ100 å¹´ï¼‰
   - ç‚¹å‡»æŸ¥çœ‹æµå¹´è¯¦æ‰¹
   - åŸºç¡€ç¼©æ”¾åŠŸèƒ½

5. **åˆ†æç»“æœå±•ç¤º**
   - 6 ä¸ªç»´åº¦è¯„åˆ†å±•ç¤º
   - åŸºç¡€ç»Ÿè®¡åˆ†æ

#### 3.2.2 MVP ä¸åŒ…å«çš„åŠŸèƒ½ï¼ˆåç»­è¿­ä»£ï¼‰

- âŒ å¤šç‰ˆæœ¬æ•°æ®æ ¼å¼å…¼å®¹ï¼ˆV2/V3/V4ï¼‰
- âŒ å¤šç»´åº¦ K çº¿å›¾
- âŒ å†å²è®°å½•åŠŸèƒ½
- âŒ æ•°æ®å¯¼å‡ºåŠŸèƒ½
- âŒ ä½¿ç”¨æ—¥å¿—åŸ‹ç‚¹
- âŒ ç‰ˆæœ¬æ›´æ–°å…¬å‘Š
- âŒ å¤æ‚çš„äº¤äº’åŠŸèƒ½ï¼ˆå…¨å±ã€é«˜çº§ç­›é€‰ç­‰ï¼‰

### 3.3 MVP æŠ€æœ¯æ ˆï¼ˆæœ€å°åŒ–ï¼‰

**å‰ç«¯**
- React + TypeScriptï¼ˆæ ¸å¿ƒæ¡†æ¶ï¼‰
- Viteï¼ˆæ„å»ºå·¥å…·ï¼‰
- Tailwind CSSï¼ˆæ ·å¼ï¼‰
- Rechartsï¼ˆå›¾è¡¨ï¼‰

**åç«¯**
- âŒ æ— éœ€åç«¯ï¼ˆMVP é˜¶æ®µï¼‰

**éƒ¨ç½²**
- GitHub Pagesï¼ˆé™æ€æ‰˜ç®¡ï¼‰

### 3.4 MVP å¼€å‘æ—¶é—´ä¼°ç®—

- **Week 1**ï¼šé¡¹ç›®æ­å»º + å…«å­—è¾“å…¥è¡¨å• + Prompt ç”Ÿæˆ
- **Week 2**ï¼šæ–‡ä»¶ä¸Šä¼  + æ•°æ®è§£æ + K çº¿å›¾åŸºç¡€å®ç°
- **Week 3**ï¼šåˆ†æç»“æœå±•ç¤º + åŸºç¡€äº¤äº’ + æµ‹è¯•ä¼˜åŒ–
- **Week 4**ï¼šUI ä¼˜åŒ– + æ–‡æ¡£ + éƒ¨ç½²ä¸Šçº¿

**æ€»è®¡**ï¼š4 å‘¨ï¼ˆ1 äººï¼‰

### 3.5 MVP åˆ°å®Œæ•´ç‰ˆæœ¬çš„è¿­ä»£è·¯å¾„

**V1.0ï¼ˆMVPï¼‰**
- âœ… åŸºç¡€åŠŸèƒ½ä¸Šçº¿
- âœ… è·å–ç”¨æˆ·åé¦ˆ

**V1.1ï¼ˆæ•°æ®å…¼å®¹ï¼‰**
- âœ… æ”¯æŒ V2/V3 æ ¼å¼
- âœ… ä¼˜åŒ–æ•°æ®è½¬æ¢é€»è¾‘

**V1.2ï¼ˆç”¨æˆ·ä½“éªŒï¼‰**
- âœ… å†å²è®°å½•åŠŸèƒ½
- âœ… æ•°æ®å¯¼å‡ºåŠŸèƒ½
- âœ… ä½¿ç”¨å¸®åŠ©æ–‡æ¡£

**V2.0ï¼ˆåŠŸèƒ½å¢å¼ºï¼‰**
- âœ… å¤šç»´åº¦ K çº¿å›¾
- âœ… ç‰ˆæœ¬æ›´æ–°å…¬å‘Š
- âœ… ä½¿ç”¨æ—¥å¿—åŸ‹ç‚¹

**V2.1+ï¼ˆæŒç»­ä¼˜åŒ–ï¼‰**
- ğŸ”„ æ€§èƒ½ä¼˜åŒ–
- ğŸ”„ æ–°åŠŸèƒ½è¿­ä»£
- ğŸ”„ ç”¨æˆ·åé¦ˆå“åº”

---

## å››ã€æŠ€æœ¯æ ˆæ·±åº¦è§£æ

### 4.1 å‰ç«¯æ ¸å¿ƒæ¡†æ¶

#### 4.1.1 React 19 + TypeScript

**æŠ€æœ¯é€‰å‹ç†ç”±**
- **React 19**ï¼šæœ€æ–°ç¨³å®šç‰ˆæœ¬ï¼Œæ”¯æŒè‡ªåŠ¨æ‰¹å¤„ç†ä¼˜åŒ–
- **TypeScript**ï¼šç±»å‹å®‰å…¨ï¼Œæå‡ä»£ç å¯ç»´æŠ¤æ€§

**æ ¸å¿ƒåº”ç”¨**

**1. ç»„ä»¶åŒ–æ¶æ„**
```typescript
// 15+ ä¸ªåŠŸèƒ½ç»„ä»¶ï¼ŒèŒè´£æ¸…æ™°
src/components/
â”œâ”€â”€ BaziForm.tsx              // å…«å­—è¾“å…¥è¡¨å•
â”œâ”€â”€ EnhancedKLineChart.tsx    // å¢å¼ºå‹ K çº¿å›¾ï¼ˆæ ¸å¿ƒç»„ä»¶ï¼Œ970+ è¡Œï¼‰
â”œâ”€â”€ MultiDimensionKLineChart.tsx // å¤šç»´åº¦ K çº¿å›¾
â”œâ”€â”€ FileUpload.tsx            // æ–‡ä»¶ä¸Šä¼ ï¼ˆæ”¯æŒæ‹–æ‹½ï¼‰
â”œâ”€â”€ PromptDisplay.tsx         // Prompt å±•ç¤ºä¸å¤åˆ¶
â”œâ”€â”€ AnalysisResult.tsx        // åˆ†æç»“æœå±•ç¤º
â”œâ”€â”€ StatisticsPanel.tsx       // ç»Ÿè®¡åˆ†æé¢æ¿
â””â”€â”€ ...
```

**2. Hooks çŠ¶æ€ç®¡ç†**
```typescript
// App.tsx - ä¸»åº”ç”¨çŠ¶æ€ç®¡ç†
const [result, setResult] = useState<LifeDestinyResult | null>(null);
const [userName, setUserName] = useState<string>('');
const [showPrompt, setShowPrompt] = useState(false);
const toast = useToast(); // è‡ªå®šä¹‰ Hook

// ä½¿ç”¨ useMemo ä¼˜åŒ–è®¡ç®—ç»“æœ
const resultOverview = useMemo(() => {
  if (!result || !result.chartData || result.chartData.length === 0) return null;
  const scores = result.chartData.map(d => d.score);
  const avg = scores.reduce((a, b) => a + b, 0) / scores.length;
  const max = Math.max(...scores);
  const min = Math.min(...scores);
  // ... å¤æ‚è®¡ç®—é€»è¾‘
  return { avgScore, maxYear, minYear, summaryText };
}, [result]);
```

**3. è‡ªå®šä¹‰ Hooks å°è£…**
```typescript
// src/hooks/useToast.ts - Toast é€šçŸ¥ç³»ç»Ÿ
export const useToast = () => {
  const [toasts, setToasts] = useState<ToastItem[]>([]);
  
  const showToast = useCallback((type: ToastType, message: string) => {
    const id = `toast-${++toastIdCounter}`;
    setToasts((prev) => [...prev, { id, type, message }]);
    return id;
  }, []);
  
  // æä¾› success/error/warning/info æ–¹æ³•
  return { toasts, success, error, warning, info, removeToast };
};
```

**æŠ€æœ¯äº®ç‚¹**
- âœ… **å‡½æ•°å¼ç»„ä»¶ + Hooks**ï¼š100% å‡½æ•°å¼ç»„ä»¶ï¼Œæ—  Class ç»„ä»¶
- âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šä½¿ç”¨ `useMemo`ã€`useCallback` ä¼˜åŒ–è®¡ç®—å’Œæ¸²æŸ“
- âœ… **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰ï¼Œç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥
- âœ… **ä»£ç å¤ç”¨**ï¼šè‡ªå®šä¹‰ Hooks å°è£…é€šç”¨é€»è¾‘

#### 4.1.2 TypeScript ä¸¥æ ¼æ¨¡å¼

**é…ç½®**
```json
// tsconfig.json
{
  "compilerOptions": {
    "strict": true,                    // å¯ç”¨æ‰€æœ‰ä¸¥æ ¼æ£€æŸ¥
    "noUnusedLocals": true,            // æœªä½¿ç”¨çš„å±€éƒ¨å˜é‡æŠ¥é”™
    "noUnusedParameters": true,        // æœªä½¿ç”¨çš„å‚æ•°æŠ¥é”™
    "noFallthroughCasesInSwitch": true, // switch è¯­å¥å¿…é¡»æœ‰ break
    "target": "ES2020",
    "module": "ESNext",
    "jsx": "react-jsx",
  }
}
```

**ç±»å‹å®šä¹‰ä½“ç³»**
```typescript
// src/types.ts - ç»Ÿä¸€çš„ç±»å‹å®šä¹‰ä¸­å¿ƒ

// æšä¸¾ç±»å‹
export enum Gender {
  MALE = 'Male',
  FEMALE = 'Female',
}

export type PromptType = 'default' | 'detailed' | 'detailed_v2' | 'detailed_v3' | 'detailed_v4' | 'custom';

// æ ¸å¿ƒæ¥å£
export interface BaziInput {
  name?: string;
  gender: Gender;
  birthYear: string;
  yearPillar: string;
  monthPillar: string;
  dayPillar: string;
  hourPillar: string;
  startAge: string;
  firstDaYun: string;
  promptType?: PromptType;
  customPrompt?: string;
}

// å¤šç‰ˆæœ¬æ•°æ®æ ¼å¼å…¼å®¹
export interface LifeDestinyResult {
  chartData: KLinePoint[];
  analysis: AnalysisData;
  v2Data?: LifeDestinyResultV2;  // V2 æ ¼å¼æ‰©å±•
  v3Extras?: {                    // V3 æ ¼å¼æ‰©å±•
    summaryOverview?: any;
    futureFocus?: any;
  };
  v4Extras?: LifeDestinyResultV4; // V4 æ ¼å¼æ‰©å±•
  userName?: string;
}
```

### 4.2 UI ä¸æ ·å¼ç³»ç»Ÿ

#### 4.2.1 Tailwind CSS

**æŠ€æœ¯é€‰å‹ç†ç”±**
- **å¼€å‘æ•ˆç‡**ï¼šåŸå­åŒ– CSSï¼Œå¿«é€Ÿæ„å»º UI
- **ä¸€è‡´æ€§**ï¼šç»Ÿä¸€çš„é—´è·ã€é¢œè‰²ç³»ç»Ÿ
- **å“åº”å¼**ï¼šå†…ç½®å“åº”å¼è®¾è®¡å·¥å…·
- **ä½“ç§¯ä¼˜åŒ–**ï¼šæŒ‰éœ€ç”Ÿæˆï¼Œç”Ÿäº§ç¯å¢ƒä½“ç§¯å°

**æ ¸å¿ƒåº”ç”¨**

**1. å“åº”å¼è®¾è®¡**
```typescript
// ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯è‡ªé€‚åº”
<div className="flex flex-col md:flex-row md:items-center gap-3">
  <h3 className="text-lg md:text-xl font-bold">æ ‡é¢˜</h3>
  <button className="hidden md:inline-flex">æ¡Œé¢ç«¯æŒ‰é’®</button>
</div>
```

**2. è‡ªå®šä¹‰åŠ¨ç”»**
```javascript
// tailwind.config.js
theme: {
  extend: {
    animation: {
      'slide-in-right': 'slideInRight 0.3s ease-out',
      'fade-in': 'fadeIn 0.3s ease-in',
    },
    keyframes: {
      slideInRight: {
        '0%': { transform: 'translateX(100%)', opacity: '0' },
        '100%': { transform: 'translateX(0)', opacity: '1' },
      },
    },
  },
}
```

### 4.3 æ•°æ®å¯è§†åŒ–

#### 4.3.1 Recharts

**æŠ€æœ¯é€‰å‹ç†ç”±**
- **React åŸç”Ÿ**ï¼šä¸“ä¸º React è®¾è®¡ï¼Œç»„ä»¶åŒ–
- **åŠŸèƒ½ä¸°å¯Œ**ï¼šæ”¯æŒå¤šç§å›¾è¡¨ç±»å‹
- **å¯å®šåˆ¶æ€§å¼º**ï¼šæ”¯æŒè‡ªå®šä¹‰ç»„ä»¶å’Œæ ·å¼
- **TypeScript æ”¯æŒ**ï¼šå®Œæ•´çš„ç±»å‹å®šä¹‰

**æ ¸å¿ƒåº”ç”¨**

**1. K çº¿å›¾å®ç°**
```typescript
// EnhancedKLineChart.tsx - è‡ªå®šä¹‰ K çº¿å½¢çŠ¶ç»„ä»¶
const CandleShape = (props: any) => {
  const { x, y, width, height, payload, yAxis } = props;
  const { open, close, high, low } = payload;
  const isUp = close >= open;
  
  // è®¡ç®—å®ä½“å’Œå½±çº¿çš„ä½ç½®
  const bodyTop = Math.min(openY, closeY);
  const bodyBottom = Math.max(openY, closeY);
  const bodyHeight = Math.max(3, bodyBottom - bodyTop);
  
  return (
    <g>
      {/* ä¸Šå½±çº¿ */}
      {hasUpperShadow && (
        <line x1={centerX} y1={highY} x2={centerX} y2={bodyTop} />
      )}
      {/* å®ä½“ */}
      <rect x={bodyX} y={bodyTop} width={bodyWidth} height={bodyHeight} />
      {/* ä¸‹å½±çº¿ */}
      {hasLowerShadow && (
        <line x1={centerX} y1={bodyBottom} x2={centerX} y2={lowY} />
      )}
    </g>
  );
};

// ä½¿ç”¨è‡ªå®šä¹‰å½¢çŠ¶
<Bar dataKey="bodyRange" shape={<CandleShape />} />
```

**2. äº¤äº’åŠŸèƒ½å®ç°**
```typescript
// ç¼©æ”¾åŠŸèƒ½
const [ageRange, setAgeRange] = useState<[number, number]>([1, 100]);

// é¼ æ ‡æ»šè½®ç¼©æ”¾
useEffect(() => {
  const handleWheel = (e: WheelEvent) => {
    e.preventDefault();
    const mouseX = e.clientX - svgRect.left;
    const ageAtMouse = ageRange[0] + (mouseX / svgWidth) * (ageRange[1] - ageRange[0]);
    // ä»¥é¼ æ ‡ä½ç½®ä¸ºä¸­å¿ƒç¼©æ”¾
    const newRange = range + delta;
    // ... è®¡ç®—æ–°çš„èŒƒå›´
  };
}, [ageRange]);

// è§¦æ‘¸ç¼©æ”¾ï¼ˆç§»åŠ¨ç«¯ï¼‰
useEffect(() => {
  const handleTouchMove = (e: TouchEvent) => {
    if (e.touches.length === 2) {
      const scale = initialDistance / currentDistance;
      const newRange = initialRange * scale;
      // ... æ›´æ–°èŒƒå›´
    }
  };
}, []);
```

**3. å¤šç»´åº¦ K çº¿å›¾**
```typescript
// MultiDimensionKLineChart.tsx - å„ç»´åº¦è¶‹åŠ¿æ›²çº¿
const chartData = useMemo(() => {
  return data.map((point) => {
    const overallYearScore = point.score ?? avgScore;
    const result: any = { age: point.age, year: point.year };

    dimensions.forEach((dim) => {
      const dimTarget = dim.overallScore || 50;
      
      // æ··åˆç®—æ³•ï¼š70% æ•´ä½“èµ°åŠ¿ + 30% ç»´åº¦ç›®æ ‡åˆ†
      const alpha = 0.7;
      const blended = overallYearScore * alpha + dimTarget * (1 - alpha);
      
      // ç¨³å®šçš„è½»å¾®æ‰°åŠ¨ï¼ˆä¿è¯ä¸åŒç»´åº¦çº¿æ¡ä¸å®Œå…¨é‡åˆï¼‰
      const seed = (point.year * 13 + dim.key.length * 17) % 11;
      const variation = (seed - 5) * 0.8; // -4 ~ +4 åˆ†çš„å°æ³¢åŠ¨
      
      const raw = blended + variation;
      const clamped = Math.max(0, Math.min(100, raw));
      result[dim.key] = Number(clamped.toFixed(1));
    });

    return result;
  });
}, [data, dimensions]);

// ç»˜åˆ¶å„ç»´åº¦æ›²çº¿
{dimensions.map(dim => (
  <Line
    key={dim.key}
    type="monotone"
    dataKey={dim.key}
    stroke={dim.color}
    strokeWidth={2.5}
    dot={false}
    activeDot={{ r: 4 }}
    name={dim.name}
  />
))}
```

### 4.4 è¡¨å•å¤„ç†ä¸æ•°æ®éªŒè¯

#### 4.4.1 React Hook Form + Zod

**æŠ€æœ¯é€‰å‹ç†ç”±**
- **React Hook Form**ï¼šéå—æ§ç»„ä»¶ï¼Œæ€§èƒ½ä¼˜ç§€
- **Zod**ï¼šTypeScript åŸç”Ÿï¼Œç±»å‹æ¨å¯¼ï¼Œè¿è¡Œæ—¶éªŒè¯

**æ ¸å¿ƒåº”ç”¨**

**1. è¡¨å•å¤„ç†**
```typescript
// BaziForm.tsx
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { baziInputSchema } from '../utils/validation';

const { register, handleSubmit, formState: { errors } } = useForm<BaziInputFormData>({
  resolver: zodResolver(baziInputSchema),
});

// è¡¨å•å­—æ®µ
<input
  {...register('birthYear')}
  className={errors.birthYear ? 'border-red-500' : ''}
/>
{errors.birthYear && <span>{errors.birthYear.message}</span>}
```

**2. æ•°æ®éªŒè¯ Schema**
```typescript
// src/utils/validation.ts

// å¹²æ”¯éªŒè¯ï¼ˆè‡ªå®šä¹‰éªŒè¯è§„åˆ™ï¼‰
const ganZhiSchema = z.string().refine(
  (val) => {
    if (!val || val.length !== 2) return false;
    const [gan, zhi] = val.split('');
    return TIAN_GAN.includes(gan) && DI_ZHI.includes(zhi);
  },
  { message: 'è¯·è¾“å…¥æ­£ç¡®çš„å¹²æ”¯æ ¼å¼ï¼ˆå¦‚ï¼šç”²å­ï¼‰' }
);

// å®Œæ•´çš„è¾“å…¥éªŒè¯ Schema
export const baziInputSchema = z.object({
  name: z.string().optional(),
  gender: z.enum(['Male', 'Female']),
  birthYear: z.string()
    .min(1, 'è¯·è¾“å…¥å‡ºç”Ÿå¹´ä»½')
    .refine((val) => {
      const year = parseInt(val);
      return !isNaN(year) && year >= 1900 && year <= 2100;
    }, { message: 'å‡ºç”Ÿå¹´ä»½åº”åœ¨ 1900-2100 ä¹‹é—´' }),
  yearPillar: ganZhiSchema,
  monthPillar: ganZhiSchema,
  dayPillar: ganZhiSchema,
  hourPillar: ganZhiSchema,
  startAge: z.string()
    .refine((val) => {
      const age = parseInt(val);
      return !isNaN(age) && age >= 1 && age <= 100;
    }, { message: 'èµ·è¿å¹´é¾„åº”åœ¨ 1-100 ä¹‹é—´' }),
  firstDaYun: ganZhiSchema,
  promptType: z.enum(['default', 'detailed', 'detailed_v2', 'detailed_v3', 'detailed_v4', 'custom']).optional(),
});

// ç±»å‹æ¨å¯¼
export type BaziInputFormData = z.infer<typeof baziInputSchema>;
```

**3. è¿è¡Œæ—¶æ•°æ®éªŒè¯**
```typescript
// FileUpload.tsx - éªŒè¯ä¸Šä¼ çš„ JSON æ•°æ®
export const validateLifeDestinyResult = (data: unknown) => {
  return lifeDestinyResultSchema.safeParse(data);
};

// ä½¿ç”¨
const result = validateLifeDestinyResult(rawData);
if (!result.success) {
  const errors = getValidationErrors(result.error);
  setError(`æ•°æ®éªŒè¯å¤±è´¥ï¼š${Object.values(errors).join(', ')}`);
  return;
}
```

### 4.5 æ„å»ºå·¥å…·ä¸å·¥ç¨‹åŒ–

#### 4.5.1 Vite

**æŠ€æœ¯é€‰å‹ç†ç”±**
- **æé€Ÿå¼€å‘**ï¼šåŸºäº ESM çš„ HMRï¼Œæ¯«ç§’çº§çƒ­æ›´æ–°
- **æ„å»ºå¿«é€Ÿ**ï¼šä½¿ç”¨ Rollup æ‰“åŒ…ï¼Œæ„å»ºé€Ÿåº¦å¿«
- **å¼€ç®±å³ç”¨**ï¼šé›¶é…ç½®ï¼Œæ”¯æŒ TypeScriptã€CSS é¢„å¤„ç†å™¨ç­‰

**æ ¸å¿ƒé…ç½®**
```typescript
// vite.config.ts
export default defineConfig({
  plugins: [react()],
  server: {
    host: 'localhost',
    port: 3000,
    strictPort: false, // ç«¯å£è¢«å ç”¨æ—¶è‡ªåŠ¨å°è¯•ä¸‹ä¸€ä¸ª
    open: true, // è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  },
  build: {
    outDir: 'dist',
    assetsDir: 'assets',
    sourcemap: false,
  },
  // ç¯å¢ƒå˜é‡å¤„ç†
  define: {
    'process.env.API_KEY': JSON.stringify(apiKey || ''),
  },
});
```

### 4.6 åç«¯ä¸åŸºç¡€è®¾æ–½

#### 4.6.1 Vercel Serverless Functions

**æŠ€æœ¯é€‰å‹ç†ç”±**
- **é›¶é…ç½®éƒ¨ç½²**ï¼šä¸ GitHub é›†æˆï¼Œè‡ªåŠ¨éƒ¨ç½²
- **æŒ‰éœ€è®¡è´¹**ï¼šServerless æ¶æ„ï¼ŒæŒ‰ä½¿ç”¨é‡è®¡è´¹
- **å…¨çƒ CDN**ï¼šè‡ªåŠ¨ CDN åŠ é€Ÿ

**æ ¸å¿ƒå®ç°**
```typescript
// api/log.ts
import { createClient } from '@supabase/supabase-js';

const supabase = createClient(
  process.env.SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE_KEY!
);

export default async function handler(req: any, res: any) {
  if (req.method !== 'POST') {
    return res.status(405).json({ error: 'Method Not Allowed' });
  }

  // æ‰‹åŠ¨è§£æè¯·æ±‚ä½“ï¼ˆå…¼å®¹ä¸åŒç¯å¢ƒï¼‰
  const body = await parseBody(req);
  const { userId, account, operation, pageData, timestamp } = body || {};

  try {
    const { error } = await supabase.from('usage_logs').insert({
      user_id: userId || null,
      account: account || null,
      operation,
      page_data: pageData ?? null,
      created_at: new Date(toSeconds(timestamp) * 1000).toISOString(),
    });
    
    if (error) throw error;
    return res.status(200).json({ ok: true });
  } catch (error) {
    return res.status(500).json({ error: 'insert failed', detail: error?.message });
  }
}
```

#### 4.6.2 Supabase

**æŠ€æœ¯é€‰å‹ç†ç”±**
- **PostgreSQL**ï¼šå¼ºå¤§çš„å…³ç³»å‹æ•°æ®åº“
- **RESTful API**ï¼šè‡ªåŠ¨ç”Ÿæˆ REST API
- **Row Level Security**ï¼šè¡Œçº§å®‰å…¨ç­–ç•¥

**æ•°æ®åº“è®¾è®¡**
```sql
-- usage_logs è¡¨
CREATE TABLE usage_logs (
  id BIGSERIAL PRIMARY KEY,
  user_id TEXT,
  account TEXT,
  operation TEXT NOT NULL,
  page_data JSONB,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ç´¢å¼•ä¼˜åŒ–
CREATE INDEX idx_operation ON usage_logs(operation);
CREATE INDEX idx_created_at ON usage_logs(created_at);
```

---

## äº”ã€æ ¸å¿ƒåŠŸèƒ½å®ç°ç»†èŠ‚

### 5.1 å¤šç‰ˆæœ¬æ•°æ®æ ¼å¼å…¼å®¹

#### 5.1.1 é—®é¢˜èƒŒæ™¯

ä¸åŒ AI æ¨¡å‹è¿”å›çš„ JSON æ ¼å¼ä¸ä¸€è‡´ï¼š
- **V1 æ ¼å¼**ï¼šåŸºç¡€æ ¼å¼ï¼ŒåŒ…å« chartPoints å’Œ analysis
- **V2 æ ¼å¼**ï¼šåŒ…å« timelineã€baseChartã€globalDimensions
- **V3 æ ¼å¼**ï¼šåŒ…å« profileã€summary.dimensions
- **V4 æ ¼å¼**ï¼šåŒ…å« bazi_logicã€history_checkpointsã€chartPointsï¼ˆk_line å­—æ®µï¼‰

#### 5.1.2 è§£å†³æ–¹æ¡ˆ

**1. ç»Ÿä¸€æ•°æ®æ¥å£è®¾è®¡**
```typescript
// src/types.ts
export interface LifeDestinyResult {
  chartData: KLinePoint[]; // ç»Ÿä¸€è½¬æ¢ä¸º KLinePoint æ ¼å¼
  analysis: AnalysisData;  // å…¼å®¹æ—§æ ¼å¼
  v2Data?: LifeDestinyResultV2;  // V2 æ ¼å¼æ‰©å±•
  v3Extras?: {                    // V3 æ ¼å¼æ‰©å±•
    summaryOverview?: any;
    futureFocus?: any;
  };
  v4Extras?: LifeDestinyResultV4; // V4 æ ¼å¼æ‰©å±•
  userName?: string;
}
```

**2. æ•°æ®è½¬æ¢å±‚**
```typescript
// src/components/FileUpload.tsx
const convertGeminiResult = (raw: any): LifeDestinyResult => {
  // æ£€æŸ¥æ˜¯å¦æ˜¯ V4 æ ¼å¼
  if (raw.bazi_logic && Array.isArray(raw.chartPoints) && raw.chartPoints.length > 0) {
    const firstPoint = raw.chartPoints[0];
    if (firstPoint.k_line || (firstPoint.open === undefined && firstPoint.k_line)) {
      // V4 æ ¼å¼è½¬æ¢
      const chartData = convertV4ChartPointsToKLinePoints(raw.chartPoints);
      const analysis = convertV4ScoresToAnalysis(raw.scores, raw.bazi_logic);
      return {
        chartData,
        analysis,
        v4Extras: {
          bazi_logic: raw.bazi_logic,
          history_checkpoints: Array.isArray(raw.history_checkpoints) ? raw.history_checkpoints : [],
          scores: raw.scores || {},
          chartPoints: raw.chartPoints,
        },
      };
    }
  }

  // æ£€æŸ¥æ˜¯å¦æ˜¯ V2 æ ¼å¼
  if (raw.timeline && Array.isArray(raw.timeline)) {
    // V2 æ ¼å¼è½¬æ¢
    const chartData = convertTimelineToKLinePoints(raw.timeline);
    const analysis = convertGlobalDimensionsToAnalysis(raw.globalDimensions, raw.baseChart);
    return {
      chartData,
      analysis,
      v2Data: {
        meta: raw.meta,
        baseChart: raw.baseChart,
        globalDimensions: raw.globalDimensions,
        timeline: raw.timeline,
      },
    };
  }

  // æ£€æŸ¥æ˜¯å¦æ˜¯ V3 æ ¼å¼
  if (raw.profile && raw.summary && raw.summary.dimensions) {
    // V3 æ ¼å¼è½¬æ¢
    // ... è½¬æ¢é€»è¾‘
  }

  // V1 æ ¼å¼ï¼ˆæ—§æ ¼å¼ï¼Œå‘åå…¼å®¹ï¼‰
  // ... è½¬æ¢é€»è¾‘
};
```

**3. æ•°æ®éªŒè¯**
```typescript
// ä½¿ç”¨ Zod è¿›è¡Œè¿è¡Œæ—¶éªŒè¯
const validationResult = validateLifeDestinyResult(convertedData);

if (!validationResult.success) {
  const errors = getValidationErrors(validationResult.error);
  setError(`æ•°æ®éªŒè¯å¤±è´¥ï¼š${Object.values(errors).join(', ')}`);
  return;
}
```

**æŠ€æœ¯äº®ç‚¹**
- âœ… **å‘åå…¼å®¹**ï¼šæ”¯æŒ 4 ç§æ•°æ®æ ¼å¼ç‰ˆæœ¬
- âœ… **ç±»å‹å®‰å…¨**ï¼šTypeScript ç±»å‹å®šä¹‰ä¿è¯æ•°æ®ä¸€è‡´æ€§
- âœ… **è¿è¡Œæ—¶éªŒè¯**ï¼šZod ç¡®ä¿æ•°æ®è´¨é‡
- âœ… **å‹å¥½é”™è¯¯æç¤º**ï¼šè¯¦ç»†çš„éªŒè¯é”™è¯¯ä¿¡æ¯

### 5.2 Prompt ç”Ÿæˆç³»ç»Ÿ

#### 5.2.1 æ ¸å¿ƒé€»è¾‘

**1. Prompt æ¨¡æ¿ç®¡ç†**
```typescript
// src/services/promptGenerator.ts

// Prompt ç¼“å­˜
const promptCache: Record<string, string> = {};

// ä»æ–‡ä»¶åŠ è½½ Prompt
const loadPromptFromFile = async (filename: string): Promise<string> => {
  if (promptCache[filename]) {
    return promptCache[filename];
  }

  try {
    const response = await fetch(`/prompts/${filename}`);
    const text = await response.text();
    promptCache[filename] = text.trim();
    return promptCache[filename];
  } catch (error) {
    console.error(`Error loading prompt ${filename}:`, error);
    return getDefaultFallbackPrompt();
  }
};
```

**2. å¤§è¿æ–¹å‘è®¡ç®—**
```typescript
// æ ¹æ®å¹´æŸ±å¤©å¹²å’Œæ€§åˆ«è®¡ç®—å¤§è¿æ–¹å‘
const getStemPolarity = (pillar: string): 'YANG' | 'YIN' => {
  const firstChar = pillar.trim().charAt(0);
  const yangStems = ['ç”²', 'ä¸™', 'æˆŠ', 'åºš', 'å£¬'];
  const yinStems = ['ä¹™', 'ä¸', 'å·±', 'è¾›', 'ç™¸'];
  
  if (yangStems.includes(firstChar)) return 'YANG';
  if (yinStems.includes(firstChar)) return 'YIN';
  return 'YANG';
};

// è®¡ç®—å¤§è¿æ–¹å‘
const yearStemPolarity = getStemPolarity(input.yearPillar);
let isForward = false;

if (input.gender === Gender.MALE) {
  isForward = yearStemPolarity === 'YANG';
} else {
  isForward = yearStemPolarity === 'YIN';
}

const daYunDirectionStr = isForward ? 'é¡ºè¡Œ (Forward)' : 'é€†è¡Œ (Backward)';
```

**3. åŒæ®µå¼ Prompt ç”Ÿæˆ**
```typescript
export const generateGeminiPrompt = async (input: BaziInput): Promise<{
  systemPrompt: string;
  userPrompt: string;
  fullPrompt: string;
}> => {
  // è·å–ç³»ç»Ÿ Promptï¼ˆå¼‚æ­¥åŠ è½½ï¼‰
  const systemPrompt = await getSystemPromptByType(promptType, input.customPrompt);

  // ç”Ÿæˆç”¨æˆ· Prompt
  const userPrompt = `è¯·æ ¹æ®ä»¥ä¸‹**å·²ç»æ’å¥½çš„**å…«å­—å››æŸ±å’Œ**æŒ‡å®šçš„å¤§è¿ä¿¡æ¯**è¿›è¡Œåˆ†æã€‚

ã€åŸºæœ¬ä¿¡æ¯ã€‘
æ€§åˆ«ï¼š${genderStr}
å‡ºç”Ÿå¹´ä»½ï¼š${input.birthYear}å¹´ (é˜³å†)

ã€å…«å­—å››æŸ±ã€‘
å¹´æŸ±ï¼š${input.yearPillar}
æœˆæŸ±ï¼š${input.monthPillar}
æ—¥æŸ±ï¼š${input.dayPillar}
æ—¶æŸ±ï¼š${input.hourPillar}

ã€å¤§è¿æ ¸å¿ƒå‚æ•°ã€‘
1. èµ·è¿å¹´é¾„ï¼š${input.startAge} å² (è™šå²)ã€‚
2. ç¬¬ä¸€æ­¥å¤§è¿ï¼š${input.firstDaYun}ã€‚
3. **æ’åºæ–¹å‘**ï¼š${daYunDirectionStr}ã€‚

ã€å¿…é¡»æ‰§è¡Œçš„ç®—æ³• - å¤§è¿åºåˆ—ç”Ÿæˆã€‘
è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ç”Ÿæˆæ•°æ®ï¼š
1. **é”å®šç¬¬ä¸€æ­¥**ï¼šç¡®è®¤ã€${input.firstDaYun}ã€‘ä¸ºç¬¬ä¸€æ­¥å¤§è¿ã€‚
2. **è®¡ç®—åºåˆ—**ï¼šæ ¹æ®å…­åç”²å­é¡ºåºå’Œæ–¹å‘ï¼ˆ${daYunDirectionStr}ï¼‰ï¼Œæ¨ç®—å‡ºæ¥ä¸‹æ¥çš„ 9 æ­¥å¤§è¿ã€‚
3. **å¡«å…… JSON**ï¼š
   - Age 1 åˆ° ${startAgeInt - 1}: daYun = "ç«¥é™"
   - Age ${startAgeInt} åˆ° ${startAgeInt + 9}: daYun = [ç¬¬1æ­¥å¤§è¿: ${input.firstDaYun}]
   - ...ä»¥æ­¤ç±»æ¨ç›´åˆ° 100 å²ã€‚

ä»»åŠ¡ï¼š
1. ç¡®è®¤æ ¼å±€ä¸å–œå¿Œã€‚
2. ç”Ÿæˆ **1-100 å² (è™šå²)** çš„äººç”Ÿæµå¹´Kçº¿æ•°æ®ã€‚
3. åœ¨ \`reason\` å­—æ®µä¸­æä¾›æµå¹´è¯¦æ‰¹ã€‚
4. ç”Ÿæˆå¸¦è¯„åˆ†çš„å‘½ç†åˆ†ææŠ¥å‘Šã€‚`;

  return { systemPrompt, userPrompt, fullPrompt };
};
```

**æŠ€æœ¯äº®ç‚¹**
- âœ… **æ¨¡æ¿åŒ–è®¾è®¡**ï¼šæ”¯æŒå¤šç§ Prompt ç±»å‹ï¼Œæ˜“äºæ‰©å±•
- âœ… **ç¼“å­˜æœºåˆ¶**ï¼šå†…å­˜ç¼“å­˜ï¼Œæå‡åŠ è½½é€Ÿåº¦
- âœ… **è‡ªåŠ¨è®¡ç®—**ï¼šè‡ªåŠ¨è®¡ç®—å¤§è¿æ–¹å‘ï¼Œå‡å°‘ç”¨æˆ·è¾“å…¥
- âœ… **é”™è¯¯å¤„ç†**ï¼šæ–‡ä»¶åŠ è½½å¤±è´¥æ—¶ä½¿ç”¨é»˜è®¤ Prompt

### 5.3 å¤šç»´åº¦ K çº¿å›¾æ‰“åˆ†é€»è¾‘

#### 5.3.1 ä¼˜åŒ–åçš„ç®—æ³•

**æ ¸å¿ƒæ€è·¯**ï¼šåŸºäºæ•´ä½“ K çº¿å¹´åº¦åˆ†æ•° + å„ç»´åº¦æ€»è¯„ï¼Œé€šè¿‡æ··åˆç®—æ³•ç”Ÿæˆå„ç»´åº¦å¹´åº¦æ›²çº¿ã€‚

```typescript
// MultiDimensionKLineChart.tsx
const chartData = useMemo(() => {
  if (!data.length) return [];

  const avgScore =
    data.reduce((sum, p) => sum + (p.score ?? 0), 0) / Math.max(data.length, 1) || 50;

  return data.map((point) => {
    const overallYearScore = point.score ?? avgScore; // å½“å‰å¹´ä»½æ•´ä½“åˆ†
    const result: any = {
      age: point.age,
      year: point.year,
    };

    dimensions.forEach((dim) => {
      const dimTarget = dim.overallScore || 50; // è¯¥ç»´åº¦çš„é•¿æœŸç›®æ ‡åˆ†ï¼ˆ0-100ï¼‰

      // 1ï¼‰æ··åˆç®—æ³•ï¼š70% æ•´ä½“èµ°åŠ¿ + 30% ç»´åº¦ç›®æ ‡åˆ†
      //   - alpha = 0.7ï¼šæ›´è´´è¿‘æ•´ä½“ K çº¿èµ°åŠ¿ï¼Œä¿è¯è¶‹åŠ¿ä¸€è‡´æ€§
      //   - (1 - alpha) = 0.3ï¼šå‘ç»´åº¦ç›®æ ‡åˆ†æ‹‰è¿‘ï¼Œä½“ç°ç»´åº¦ç‰¹æ€§
      const alpha = 0.7;
      const blended = overallYearScore * alpha + dimTarget * (1 - alpha);

      // 2ï¼‰æ ¹æ®å¹´ä»½å’Œç»´åº¦ key ç”Ÿæˆä¸€ä¸ªç¨³å®šçš„è½»å¾®æ‰°åŠ¨
      //   - ä½¿ç”¨å¹´ä»½å’Œ key é•¿åº¦ä½œä¸ºç§å­ï¼Œä¿è¯ç›¸åŒè¾“å…¥äº§ç”Ÿç›¸åŒè¾“å‡º
      //   - variation èŒƒå›´ï¼š-4 ~ +4 åˆ†ï¼Œä¿è¯ä¸åŒç»´åº¦çº¿æ¡ä¸å®Œå…¨é‡åˆ
      const seed = (point.year * 13 + dim.key.length * 17) % 11; // 0-10
      const variation = (seed - 5) * 0.8; // -4 ~ +4 åˆ†çš„å°æ³¢åŠ¨

      const raw = blended + variation;
      const clamped = Math.max(0, Math.min(100, raw));
      result[dim.key] = Number(clamped.toFixed(1));
    });

    return result;
  });
}, [data, dimensions]);
```

**ç®—æ³•ä¼˜åŠ¿**
- âœ… **è¶‹åŠ¿ä¸€è‡´æ€§**ï¼š70% æƒé‡ä¿è¯å„ç»´åº¦æ›²çº¿ä¸æ•´ä½“ K çº¿è¶‹åŠ¿ä¸€è‡´
- âœ… **ç»´åº¦å·®å¼‚åŒ–**ï¼š30% æƒé‡ä½“ç°å„ç»´åº¦çš„é•¿æœŸç‰¹æ€§
- âœ… **ç¨³å®šæ€§**ï¼šä½¿ç”¨ç¡®å®šæ€§ç®—æ³•ï¼Œç›¸åŒè¾“å…¥äº§ç”Ÿç›¸åŒè¾“å‡º
- âœ… **å¹³æ»‘æ€§**ï¼šæ‰°åŠ¨èŒƒå›´å°ï¼ˆÂ±4 åˆ†ï¼‰ï¼Œæ›²çº¿å¹³æ»‘è‡ªç„¶

---

## å…­ã€æ¶æ„è®¾è®¡

### 6.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯åº”ç”¨å±‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  App.tsx â”‚  â”‚ Componentsâ”‚  â”‚  Hooks   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æœåŠ¡å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚promptGeneratorâ”‚  â”‚ usageLogger  â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å·¥å…·å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  validation  â”‚  â”‚   storage     â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åç«¯æœåŠ¡ï¼ˆå¯é€‰ï¼‰                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚Vercel Functionâ”‚  â”‚   Supabase   â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 ç»„ä»¶å±‚æ¬¡ç»“æ„

```
App.tsx (ä¸»åº”ç”¨)
â”œâ”€â”€ Header (å¯¼èˆªæ )
â”œâ”€â”€ Multi-step Guide (æ­¥éª¤æŒ‡ç¤ºå™¨)
â”œâ”€â”€ BaziForm (å…«å­—è¾“å…¥è¡¨å•)
â”œâ”€â”€ FileUpload (æ–‡ä»¶ä¸Šä¼ )
â”œâ”€â”€ PromptDisplay (Prompt å±•ç¤º)
â”œâ”€â”€ Results View (ç»“æœå±•ç¤º)
â”‚   â”œâ”€â”€ Result Overview (æ•´ä½“æ¦‚è§ˆ)
â”‚   â”œâ”€â”€ Key Years Summary (å…³é”® 5 å¹´)
â”‚   â”œâ”€â”€ Future Focus (æœªæ¥ 3 å¹´)
â”‚   â”œâ”€â”€ EnhancedKLineChart (æ€»ä½“ K çº¿å›¾)
â”‚   â”œâ”€â”€ MultiDimensionKLineChart (å¤šç»´åº¦ K çº¿å›¾)
â”‚   â”œâ”€â”€ StatisticsPanel (ç»Ÿè®¡åˆ†æ)
â”‚   â”œâ”€â”€ DimensionComparisonChart (ç»´åº¦å¯¹æ¯”)
â”‚   â””â”€â”€ AnalysisResult (æ–‡æœ¬æŠ¥å‘Š)
â”œâ”€â”€ HistoryPanel (å†å²è®°å½•)
â”œâ”€â”€ HelpPage (å¸®åŠ©é¡µé¢)
â”œâ”€â”€ ToastContainer (é€šçŸ¥å®¹å™¨)
â””â”€â”€ AnnouncementModal (æ›´æ–°å…¬å‘Š)
```

### 6.3 æ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥ (BaziInput)
    â”‚
    â–¼
ç”Ÿæˆ Prompt (promptGenerator)
    â”‚
    â–¼
ç”¨æˆ·ä¸ AI å¯¹è¯ (å¤–éƒ¨)
    â”‚
    â–¼
ä¸Šä¼  JSON (FileUpload)
    â”‚
    â–¼
æ•°æ®è½¬æ¢ (convertGeminiResult)
    â”‚
    â–¼
æ•°æ®éªŒè¯ (Zod validation)
    â”‚
    â–¼
çŠ¶æ€æ›´æ–° (setResult)
    â”‚
    â–¼
UI æ¸²æŸ“ (Components)
```

---

## ä¸ƒã€æ•°æ®æµä¸çŠ¶æ€ç®¡ç†

### 7.1 çŠ¶æ€ç®¡ç†ç­–ç•¥

**é‡‡ç”¨ React Hooks è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Œæ— å…¨å±€çŠ¶æ€ç®¡ç†åº“ï¼ˆRedux/Zustandï¼‰**

**åŸå› **ï¼š
- åº”ç”¨è§„æ¨¡é€‚ä¸­ï¼Œç»„ä»¶å±‚çº§ä¸æ·±
- çŠ¶æ€å…±äº«éœ€æ±‚æœ‰é™ï¼Œä¸»è¦é€šè¿‡ Props ä¼ é€’
- å‡å°‘ä¾èµ–ï¼Œé™ä½å¤æ‚åº¦

**çŠ¶æ€åˆ†å¸ƒ**ï¼š
```typescript
// App.tsx - å…¨å±€çŠ¶æ€
const [result, setResult] = useState<LifeDestinyResult | null>(null);
const [userName, setUserName] = useState<string>('');
const [showPrompt, setShowPrompt] = useState(false);
const [promptData, setPromptData] = useState<...>(null);

// ç»„ä»¶å†…éƒ¨çŠ¶æ€
// EnhancedKLineChart.tsx
const [ageRange, setAgeRange] = useState<[number, number]>([1, 100]);
const [showKeyYears, setShowKeyYears] = useState(true);
const [zoomLevel, setZoomLevel] = useState(1);

// MultiDimensionKLineChart.tsx
const [activeDimensions, setActiveDimensions] = useState<string[]>(['summary', 'wealth', 'marriage']);
```

### 7.2 æ•°æ®æŒä¹…åŒ–

**1. æœ¬åœ°å­˜å‚¨ï¼ˆlocalStorageï¼‰**
```typescript
// src/utils/storage.ts
export const saveToHistory = (result: LifeDestinyResult, input: BaziInput) => {
  try {
    const history = getHistory();
    const newEntry = {
      id: Date.now().toString(),
      timestamp: new Date().toISOString(),
      userName: result.userName || input.name || 'æœªå‘½å',
      input,
      result: {
        chartData: result.chartData.slice(0, 10), // åªä¿å­˜å‰ 10 ä¸ªæ•°æ®ç‚¹
        analysis: result.analysis,
      },
    };
    
    const updated = [newEntry, ...history.slice(0, 49)]; // æœ€å¤šä¿å­˜ 50 æ¡
    localStorage.setItem('lifekline_history', JSON.stringify(updated));
  } catch (error) {
    console.error('Failed to save history:', error);
  }
};
```

**2. ç‰ˆæœ¬è®°å¿†ï¼ˆlocalStorageï¼‰**
```typescript
// App.tsx - å…¬å‘Šç‰ˆæœ¬è®°å¿†
const ANNOUNCEMENT_VERSION = 'multi-dimension-kline-v1';

useEffect(() => {
  try {
    if (typeof window === 'undefined') return;
    const seenVersion = window.localStorage.getItem('announcement_version');
    if (seenVersion !== ANNOUNCEMENT_VERSION) {
      setShowAnnouncement(true);
    }
  } catch {
    // å¿½ç•¥ localStorage å¼‚å¸¸
  }
}, []);
```

---

## å…«ã€æ€§èƒ½ä¼˜åŒ–å®è·µ

### 8.1 React æ€§èƒ½ä¼˜åŒ–

**1. useMemo ä¼˜åŒ–è®¡ç®—**
```typescript
// é¿å…é‡å¤è®¡ç®—
const resultOverview = useMemo(() => {
  if (!result || !result.chartData || result.chartData.length === 0) return null;
  const scores = result.chartData.map(d => d.score);
  const avg = scores.reduce((a, b) => a + b, 0) / scores.length;
  // ... å¤æ‚è®¡ç®—
  return { avgScore, maxYear, minYear, summaryText };
}, [result]); // åªæœ‰ result å˜åŒ–æ—¶æ‰é‡æ–°è®¡ç®—
```

**2. useCallback ä¼˜åŒ–å‡½æ•°**
```typescript
// é¿å…å­ç»„ä»¶ä¸å¿…è¦çš„é‡æ¸²æŸ“
const handleGeneratePrompt = useCallback(async (data: BaziInput) => {
  // ... å¤„ç†é€»è¾‘
}, []); // ä¾èµ–é¡¹ä¸ºç©ºï¼Œå‡½æ•°å¼•ç”¨ç¨³å®š
```

**3. æ•°æ®è¿‡æ»¤ä¼˜åŒ–**
```typescript
// å›¾è¡¨æ•°æ®è¿‡æ»¤
const filteredData = useMemo(() => {
  return data.filter(d => d.age >= ageRange[0] && d.age <= ageRange[1]);
}, [data, ageRange]);
```

### 8.2 å›¾è¡¨æ€§èƒ½ä¼˜åŒ–

**1. æ•°æ®é‡‡æ ·ï¼ˆå¯é€‰ï¼‰**
```typescript
// æ ¹æ®ç¼©æ”¾çº§åˆ«é‡‡æ ·æ•°æ®
const getSampledData = (data: KLinePoint[], zoomLevel: number) => {
  if (zoomLevel > 0.5) return data; // é«˜ç¼©æ”¾æ˜¾ç¤ºå…¨éƒ¨
  const step = Math.ceil(1 / zoomLevel);
  return data.filter((_, index) => index % step === 0);
};
```

**2. è™šæ‹Ÿæ»šåŠ¨ï¼ˆæœªæ¥ä¼˜åŒ–ï¼‰**
```typescript
// å¯ä»¥ä½¿ç”¨ react-window å®ç°è™šæ‹Ÿæ»šåŠ¨
import { FixedSizeList } from 'react-window';
```

### 8.3 æ„å»ºä¼˜åŒ–

**1. ä»£ç åˆ†å‰²ï¼ˆå»ºè®®ï¼‰**
```typescript
// vite.config.ts
build: {
  rollupOptions: {
    output: {
      manualChunks: {
        'react-vendor': ['react', 'react-dom'],
        'chart-vendor': ['recharts'],
        'form-vendor': ['react-hook-form', 'zod'],
      },
    },
  },
}
```

---

## ä¹ã€é¢è¯•å›ç­”è¦ç‚¹

### 9.1 é¡¹ç›®ä»‹ç»ï¼ˆ2-3åˆ†é’Ÿï¼‰

> "è¿™æ˜¯ä¸€ä¸ªå°†ä¼ ç»Ÿå…«å­—å‘½ç†å­¦ä¸ç°ä»£å¯è§†åŒ–æŠ€æœ¯ç›¸ç»“åˆçš„å‰ç«¯é¡¹ç›®ã€‚æ ¸å¿ƒæ€è·¯æ˜¯è®©ç”¨æˆ·é€šè¿‡ 3 æ­¥ç®€å•æ“ä½œï¼Œå°±èƒ½è·å¾— 100 å¹´äººç”Ÿè¿åŠ¿çš„ K çº¿å›¾å¯è§†åŒ–ã€‚
>
> **é¡¹ç›®èƒŒæ™¯**ï¼šä¼ ç»Ÿå‘½ç†å·¥å…·å­˜åœ¨è¾“å…¥ç¹çã€ç»“æœæŠ½è±¡ã€éš¾ä»¥ä¿å­˜çš„ç—›ç‚¹ã€‚æˆ‘é€šè¿‡ç®€åŒ–æµç¨‹ã€å¯è§†åŒ–å±•ç¤ºã€å¤šç»´åº¦åˆ†æè§£å†³äº†è¿™äº›é—®é¢˜ã€‚
>
> **æŠ€æœ¯äº®ç‚¹**ï¼š
> 1. **å¤šç‰ˆæœ¬æ•°æ®å…¼å®¹**ï¼šè®¾è®¡äº†ç»Ÿä¸€çš„æ•°æ®è½¬æ¢å±‚ï¼Œæ”¯æŒ V1/V2/V3/V4 å››ç§ JSON æ ¼å¼ï¼Œé€šè¿‡ TypeScript + Zod ä¿è¯ç±»å‹å®‰å…¨å’Œæ•°æ®è´¨é‡
> 2. **å¢å¼ºå‹ K çº¿å›¾ç»„ä»¶**ï¼šä½¿ç”¨ Recharts è‡ªå®šä¹‰ K çº¿å½¢çŠ¶ï¼Œå®ç°äº†ç¼©æ”¾ã€ç­›é€‰ã€å…³é”®å¹´ä»½æ ‡æ³¨ã€å…¨å±ç­‰ä¸°å¯Œçš„äº¤äº’åŠŸèƒ½ï¼Œæ”¯æŒæ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯
> 3. **å¤šç»´åº¦ K çº¿å›¾**ï¼šåŸºäºæ•´ä½“ K çº¿å’Œå„ç»´åº¦è¯„åˆ†ï¼Œé€šè¿‡æ··åˆç®—æ³•ï¼ˆ70% æ•´ä½“èµ°åŠ¿ + 30% ç»´åº¦ç‰¹æ€§ï¼‰ç”Ÿæˆå„ç»´åº¦è¶‹åŠ¿æ›²çº¿
> 4. **æ•°æ®é—­ç¯æœºåˆ¶**ï¼šå‰ç«¯ç»Ÿä¸€åŸ‹ç‚¹ + Vercel Serverless + Supabase å­˜å‚¨ï¼Œé€šè¿‡æ•°æ®åˆ†æå’Œç”¨æˆ·åé¦ˆæŒç»­ä¼˜åŒ–äº§å“
>
> **ä¸ªäººè´¡çŒ®**ï¼šä» 0 åˆ° 1 ä¸»å¯¼é¡¹ç›®ï¼ŒåŒ…æ‹¬éœ€æ±‚åˆ†æã€æŠ€æœ¯æ¶æ„è®¾è®¡ã€å‰åç«¯å¼€å‘ã€‚é€šè¿‡æ•°æ®é©±åŠ¨çš„æ–¹å¼ï¼Œå°† AI è¾“å‡ºæ ¼å¼ç¨³å®šç‡ä» ~60% æå‡åˆ° ~95%ã€‚"

### 9.2 æŠ€æœ¯éš¾ç‚¹ï¼ˆ1-2åˆ†é’Ÿï¼‰

> "æœ€å¤§çš„æŠ€æœ¯éš¾ç‚¹æ˜¯å¤„ç†ä¸åŒ AI æ¨¡å‹è¿”å›çš„ JSON æ ¼å¼ä¸ä¸€è‡´é—®é¢˜ã€‚
>
> **é—®é¢˜**ï¼šä¸åŒç‰ˆæœ¬çš„ Prompt æ¨¡æ¿å¯¼è‡´ AI è¿”å›çš„æ•°æ®ç»“æ„ä¸åŒï¼ŒV1/V2/V3/V4 æ ¼å¼å·®å¼‚å¾ˆå¤§ã€‚
>
> **è§£å†³æ–¹æ¡ˆ**ï¼š
> 1. **ç»Ÿä¸€æ•°æ®æ¥å£è®¾è®¡**ï¼šå®šä¹‰äº† `LifeDestinyResult` æ¥å£ï¼ŒåŒ…å«åŸºç¡€å­—æ®µå’Œå¯é€‰çš„æ‰©å±•å­—æ®µï¼ˆv2Dataã€v3Extrasã€v4Extrasï¼‰
> 2. **æ•°æ®è½¬æ¢å±‚**ï¼šå®ç°äº† `convertGeminiResult` å‡½æ•°ï¼Œè‡ªåŠ¨è¯†åˆ«æ ¼å¼ç‰ˆæœ¬å¹¶è½¬æ¢
> 3. **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨ TypeScript å®šä¹‰å®Œæ•´ç±»å‹ï¼ŒZod è¿›è¡Œè¿è¡Œæ—¶éªŒè¯
> 4. **è¿­ä»£ä¼˜åŒ–**ï¼šé€šè¿‡åŸ‹ç‚¹æ•°æ®åˆ†æï¼ŒæŒç»­ä¼˜åŒ– Prompt æ¨¡æ¿ï¼Œæå‡æ ¼å¼ç¨³å®šç‡
>
> **æ”¶è·**ï¼šå­¦ä¼šäº†å¦‚ä½•è®¾è®¡å¯æ‰©å±•çš„æ•°æ®æ¶æ„ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡æ•°æ®é©±åŠ¨çš„æ–¹å¼ä¼˜åŒ–ç³»ç»Ÿã€‚"

### 9.3 æŠ€æœ¯é€‰å‹ï¼ˆ1åˆ†é’Ÿï¼‰

> "æˆ‘é€‰æ‹©è¿™äº›æŠ€æœ¯æ ˆä¸»è¦åŸºäºä»¥ä¸‹å‡ ä¸ªè€ƒè™‘ï¼š
>
> **1. å¼€å‘æ•ˆç‡**ï¼šVite + React + TypeScript æä¾›äº†æé€Ÿçš„å¼€å‘ä½“éªŒå’Œç±»å‹å®‰å…¨ï¼ŒTailwind CSS è®© UI å¼€å‘æ›´é«˜æ•ˆã€‚
>
> **2. æ€§èƒ½è¦æ±‚**ï¼šRecharts ä¸“ä¸º React è®¾è®¡ï¼Œæ€§èƒ½ä¼˜ç§€ï¼›React Hook Form ä½¿ç”¨éå—æ§ç»„ä»¶ï¼Œå‡å°‘ä¸å¿…è¦çš„é‡æ¸²æŸ“ã€‚
>
> **3. ç±»å‹å®‰å…¨**ï¼šTypeScript + Zod æä¾›äº†ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶çš„åŒé‡ç±»å‹ä¿éšœï¼Œç¡®ä¿æ•°æ®è´¨é‡ã€‚
>
> **4. å…¨æ ˆèƒ½åŠ›**ï¼šVercel Serverless + Supabase è®©æˆ‘èƒ½å¤Ÿå¿«é€Ÿæ­å»ºåç«¯æœåŠ¡ï¼Œæ— éœ€ç®¡ç†æœåŠ¡å™¨ã€‚
>
> **5. å¯ç»´æŠ¤æ€§**ï¼šå®Œæ•´çš„ç±»å‹å®šä¹‰ã€ç»„ä»¶åŒ–æ¶æ„ã€é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œè®©ä»£ç æ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚"

### 9.4 äº§å“æ€ç»´ï¼ˆ1åˆ†é’Ÿï¼‰

> "è¿™ä¸ªé¡¹ç›®è®©æˆ‘æ·±å…¥å®è·µäº†äº§å“æ€ç»´ï¼š
>
> **1. ç”¨æˆ·ç ”ç©¶**ï¼šé€šè¿‡è§‚å¯Ÿä¼ ç»Ÿå·¥å…·çš„ç—›ç‚¹ï¼Œè¯†åˆ«å‡ºè¾“å…¥ç¹çã€ç»“æœæŠ½è±¡ã€éš¾ä»¥ä¿å­˜ä¸‰å¤§é—®é¢˜
>
> **2. è§£å†³æ–¹æ¡ˆè®¾è®¡**ï¼šå°†å¤æ‚çš„æ’ç›˜æµç¨‹ç®€åŒ–ä¸º 3 æ­¥ï¼Œç”¨ K çº¿å›¾å¯è§†åŒ–è¶‹åŠ¿ï¼Œè®¾è®¡å¤šç»´åº¦åˆ†æä½“ç³»
>
> **3. æ•°æ®é©±åŠ¨è¿­ä»£**ï¼š
> - é€šè¿‡åŸ‹ç‚¹è®°å½•ç”¨æˆ·è¡Œä¸ºï¼ˆç”Ÿæˆ Promptã€ä¸Šä¼ ç»“æœã€æŸ¥çœ‹å†å²ç­‰ï¼‰
> - ç»“åˆç”¨æˆ·åé¦ˆï¼Œè¿­ä»£ä¼˜åŒ– Prompt ç»“æ„å’Œäº¤äº’æµç¨‹
> - æ ¼å¼ç¨³å®šç‡ä» ~60% æå‡åˆ° ~95%
>
> **4. MVP æ€ç»´**ï¼šå…ˆå®ç°æ ¸å¿ƒåŠŸèƒ½ï¼ˆå…«å­—è¾“å…¥ã€Prompt ç”Ÿæˆã€K çº¿å›¾å±•ç¤ºï¼‰ï¼Œå†é€æ­¥æ·»åŠ å¤šç»´åº¦åˆ†æã€å†å²è®°å½•ã€æ•°æ®å¯¼å‡ºç­‰åŠŸèƒ½"

### 9.5 é¡¹ç›®äº®ç‚¹æ€»ç»“

**æŠ€æœ¯äº®ç‚¹**
1. âœ… **å¤šç‰ˆæœ¬æ•°æ®å…¼å®¹**ï¼šç»Ÿä¸€çš„æ•°æ®è½¬æ¢å±‚ï¼Œæ”¯æŒ 4 ç§æ ¼å¼ç‰ˆæœ¬
2. âœ… **å¢å¼ºå‹å›¾è¡¨ç»„ä»¶**ï¼šè‡ªå®šä¹‰ K çº¿å½¢çŠ¶ï¼Œä¸°å¯Œçš„äº¤äº’åŠŸèƒ½
3. âœ… **å¤šç»´åº¦å¯è§†åŒ–**ï¼šæ··åˆç®—æ³•ç”Ÿæˆå„ç»´åº¦è¶‹åŠ¿æ›²çº¿
4. âœ… **æ•°æ®é—­ç¯æœºåˆ¶**ï¼šåŸ‹ç‚¹ + åé¦ˆ + è¿­ä»£ä¼˜åŒ–

**äº§å“äº®ç‚¹**
1. âœ… **é™ä½ä½¿ç”¨é—¨æ§›**ï¼š3 æ­¥ä¸»æµç¨‹ï¼Œé™ä½å­¦ä¹ æˆæœ¬
2. âœ… **å¯è§†åŒ–è¶‹åŠ¿**ï¼šK çº¿å›¾ç›´è§‚å±•ç¤ºäººç”Ÿè¿åŠ¿
3. âœ… **å¤šç»´åº¦åˆ†æ**ï¼š6 å¤§ç»´åº¦å…¨é¢åˆ†æ
4. âœ… **æ•°æ®é©±åŠ¨**ï¼šé€šè¿‡æ•°æ®åˆ†ææŒç»­ä¼˜åŒ–äº§å“

**ä¸ªäººè´¡çŒ®**
1. âœ… **ä» 0 åˆ° 1**ï¼šä¸»å¯¼éœ€æ±‚åˆ†æã€æŠ€æœ¯æ¶æ„ã€å‰åç«¯å¼€å‘
2. âœ… **æŠ€æœ¯æ·±åº¦**ï¼šæ·±å…¥å®è·µ Reactã€TypeScriptã€æ•°æ®å¯è§†åŒ–
3. âœ… **äº§å“æ€ç»´**ï¼šç”¨æˆ·ç ”ç©¶ã€æ•°æ®é©±åŠ¨ã€è¿­ä»£ä¼˜åŒ–
4. âœ… **å…¨æ ˆèƒ½åŠ›**ï¼šå‰ç«¯ + Serverless + æ•°æ®åº“è®¾è®¡

---

## åã€é¡¹ç›®æ•°æ®ä¸æˆæœ

### 10.1 æŠ€æœ¯æŒ‡æ ‡

- **ä»£ç é‡**ï¼š~15,000 è¡Œ TypeScript/TSX
- **ç»„ä»¶æ•°**ï¼š15+ ä¸ªåŠŸèƒ½ç»„ä»¶
- **ç±»å‹å®šä¹‰**ï¼šå®Œæ•´çš„ TypeScript ç±»å‹ä½“ç³»
- **æ•°æ®æ ¼å¼å…¼å®¹**ï¼šæ”¯æŒ 4 ç§ JSON æ ¼å¼ç‰ˆæœ¬
- **æ ¼å¼ç¨³å®šç‡**ï¼šä» ~60% æå‡åˆ° ~95%

### 10.2 åŠŸèƒ½æŒ‡æ ‡

- **æ ¸å¿ƒåŠŸèƒ½**ï¼š8 ä¸ªä¸»è¦åŠŸèƒ½æ¨¡å—
- **äº¤äº’åŠŸèƒ½**ï¼šç¼©æ”¾ã€ç­›é€‰ã€å…¨å±ã€è§¦æ‘¸æ”¯æŒç­‰
- **æ•°æ®å¯¼å‡º**ï¼šæ”¯æŒ JSON/PNG/PDF ä¸‰ç§æ ¼å¼
- **å“åº”å¼è®¾è®¡**ï¼šæ”¯æŒæ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯

### 10.3 ç”¨æˆ·ä½“éªŒæŒ‡æ ‡

- **æ“ä½œæ­¥éª¤**ï¼š3 æ­¥ä¸»æµç¨‹ï¼ˆå¡«å…«å­— â†’ ç”Ÿæˆ Prompt â†’ ä¸Šä¼  JSONï¼‰
- **å­¦ä¹ æˆæœ¬**ï¼šæä¾›è¯¦ç»†çš„ä½¿ç”¨å¸®åŠ©æ–‡æ¡£
- **é”™è¯¯å¤„ç†**ï¼šå‹å¥½çš„é”™è¯¯æç¤ºå’ŒéªŒè¯ä¿¡æ¯
- **æ€§èƒ½ä½“éªŒ**ï¼šæµç•…çš„å›¾è¡¨äº¤äº’ï¼Œæ”¯æŒå¤§æ•°æ®é‡æ¸²æŸ“

---

## åä¸€ã€åç»­ä¼˜åŒ–æ–¹å‘

### 11.1 æŠ€æœ¯ä¼˜åŒ–

- **ä»£ç åˆ†å‰²**ï¼šå®ç°æ‡’åŠ è½½ï¼Œå‡å°‘åˆå§‹åŒ…ä½“ç§¯
- **å›¾è¡¨è™šæ‹ŸåŒ–**ï¼šä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–å¤§æ•°æ®é‡æ¸²æŸ“
- **Service Worker**ï¼šæ·»åŠ ç¦»çº¿æ”¯æŒ
- **æ„å»ºä¼˜åŒ–**ï¼šä¼˜åŒ–æ‰“åŒ…é…ç½®ï¼Œå‡å°‘æ„å»ºäº§ç‰©å¤§å°

### 11.2 åŠŸèƒ½æ‰©å±•

- **æ›´å¤š AI å¹³å°**ï¼šæ”¯æŒæ›´å¤š AI æ¨¡å‹
- **æ•°æ®å¯¹æ¯”**ï¼šæ”¯æŒå¤šä¸ªå‘½ç›˜å¯¹æ¯”
- **åˆ†äº«åŠŸèƒ½**ï¼šç”Ÿæˆåˆ†äº«é“¾æ¥ï¼Œæ–¹ä¾¿ä¼ æ’­
- **æ•°æ®åˆ†æ**ï¼šåŸºäºå†å²æ•°æ®æä¾›æ›´æ·±å…¥çš„åˆ†æ

### 11.3 äº§å“ä¼˜åŒ–

- **ç”¨æˆ·åé¦ˆ**ï¼šå»ºç«‹æ›´å®Œå–„çš„åé¦ˆæœºåˆ¶
- **ä½¿ç”¨æ•™ç¨‹**ï¼šæ·»åŠ è§†é¢‘æ•™ç¨‹å’Œç¤ºä¾‹
- **ç¤¾åŒºåŠŸèƒ½**ï¼šå»ºç«‹ç”¨æˆ·ç¤¾åŒºï¼Œåˆ†äº«å‘½ç†å¿ƒå¾—
- **å•†ä¸šåŒ–æ¢ç´¢**ï¼šæ¢ç´¢åˆç†çš„å•†ä¸šæ¨¡å¼

---

**æ€»ç»“**ï¼šè¿™ä¸ªé¡¹ç›®å±•ç¤ºäº†ä»å‰ç«¯åˆ°åç«¯ã€ä»å¼€å‘åˆ°éƒ¨ç½²çš„å®Œæ•´æŠ€æœ¯æ ˆåº”ç”¨ï¼Œä½“ç°äº†å¯¹ç°ä»£å‰ç«¯å¼€å‘æœ€ä½³å®è·µçš„æ·±å…¥ç†è§£å’Œå®è·µèƒ½åŠ›ï¼ŒåŒæ—¶ä¹Ÿå±•ç°äº†äº§å“æ€ç»´å’Œæ•°æ®é©±åŠ¨çš„è¿­ä»£æ–¹å¼ã€‚

